<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>chapter9</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>TCP/IPによる通信の仕組みを理解する</h1>
  <div class="sectionWrapper">
    <h2>TCP/IPとは</h2>
    復習
    <ul>
      <li>IPアドレス</li>
      ネットワーク上のアドレス。ICANNという団体によって管理されている
      <br>パブリックなものとプライベートなものがあり、プライベートIPは自由に利用できる
      <br>通信のときはパケットをバケツリレーのようにルータが運んでいく。その時のルーティング情報はEGPやIGPを使って交換する
      <div class="box">ここでEGPとはAS(Autonomous System)というきぎょうが構築しているまとまった大きなネットワーク同士をつなぐもの、IGPはその内部でつながっているものを指す</div>
      <li>ポート番号</li>
      ポート番号を使うことで一つのIPアドレスで複数の通信ができるようになる。
      <br>WebやSMTPなどのよく使われるサービスは利用できるポート番号が決まっていてそれをウェルノウンポートと呼ぶ
      <br>例：Webサーバは８０番
      <li>DNS</li>
      IPアドレスは数字の名前で覚えにくいのでドメイン名を使ってIPアドレスを変換する。コレを名前解決とよび、もちろんその時のIPアドレスとはパブリックIPアドレスのこと
      <li>HTTP</li>
      WebサーバとwebブラウザはHTTPを使ってデータをやりとりする
    </ul>
    <strong>これら一連の処理がTCP/IPというモデルによって構成されている</strong>
    <div class="itemWrapper">
      <h3>モデルの階層構造</h3>
      <table>
        <thead>
          <tr>
            <th>層</th>
            <th>役割</th>
            <th>代表例</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>アプリケーション層</td>
            <td>ソフトウェア同士の会話</td>
            <td>HTTP,SSH,DNS,SMTP</td>
          </tr>
          <tr>
            <td>トランスポート層</td>
            <td>データのやり取りの順番を制御し、信頼性のあるデータ通信を行う</td>
            <td>TCP,UDP</td>
          </tr>
          <tr>
            <td>インターネット層</td>
            <td>IPアドレスの割当やルーティング</td>
            <td>IP,ICMP,ARP</td>
          </tr>
          <tr>
            <td>インターフェース層</td>
            <td>ネットワーク内の機器同士通信</td>
            <td>Ethernet,PPP</td>
          </tr>
        </tbody>
      </table>
      <div class="box">
        上の階層は下の階層が何かに依存しません、つまりインターフェース層が何であれインターネット層には影響しないように各階層は独立しています
      </div>
    </div>
    <div class="itemWrapper">
      <h3>データのカプセル化</h3>
      これらの改装を意識して、構築したWebサーバにローカル環境のWebぶらうざカラ接続してWebページを表示するという操作のうち、DNSが名前解決するという処理に焦点を当てて詳しく見よう
      <ol>
        <li>名前解決のリクエスト作成(アプリケーション層)</li>
        コレはアプリケーション層で、アドレス欄に入力されたURLからドメイン名を抜き出して名前解決をしようとしています
        <br>DNSサーバーに名前解決の処理を依頼するため、DNSプロトコルのフォーマットに従いリクエストを作ります
        <li>UDPでカプセル化(トランスポート層)</li>
        <br>1のデータをトランスポート層にわたすときに<div class="red">カプセル化</div>
        されます。
        <br>カプセル化とは中身のデータに手を加えずに下の階層で処理できるようにデータを付与することです
        <br>トランスポート層のプロトコルはTCPかUDPなので、送信元のポート番号、宛先ポート番号、データの長さ、エラーがないかを調べるチェックサムなどが付け足されます。
        <br>ちなみにデフォルトはUDPで、DNSのウェルノウンポートは５３番です。このときのこれらの情報をUDPへっだーと呼びます。
        <li>IPでカプセル化(インターネット層)</li>
        ２のデータをインターネット層に渡します。インターネット層のプロトコルはIPで、IPでのカプセル化は【送信元IP】【宛先IP】【データ長】【生存期間】などの情報がたされます
        <li>Ethernetでカプセル化(インターフェース層)</li>
        ３の段階でIPアドレスがつくのでLANや電話回線などの配線上に流すことができるようになりました。それぞれの配線の企画に準拠したヘッダーをつけましょう。
        <br>例えばLANはEthernetという規格を使っていて、戦闘と末尾にいくつかのデータが追加されます。コレをEthernetフレームと呼びます。
        <br>そこには送信元MACアドレスと宛先MACアドレスが含まれます。
        <br>ちなみにEthernetフレームワークのデータ長は1,518バイト以内ときめられているので大きかったら分割して番号で管理します

      </ol>
    </div>
    <div class="itemWrapper">
      <h3>EthernetとTCP/IPの関係</h3>
      Ehernetで通信するパソコンやサーバー、各種ネットワーク機器などのホストには唯一無二のMACアドレスと呼ばれる番号が割り振られており、コレによって管理しています
      <div class="subItemWrapper">
        <h4>ARPでIPアドレスを解決する</h4>
        EthernetではMACアドレスを頼りにデータを送信します。しかしEthernetは中身のIPを見ることができないので、MACアドレスとIPアドレスの対応する表が必要となります。
        <br>そこでARPというプロトコルが登場します。
        <br>一度ARP要求とARP応答をすることで対応表が作られて、以降はそれを元に通信ができるようになるのです
      </div>
      <div class="subItemWrapper">
        <h4>ARPの範囲</h4>
        ARP要求はDNSサーバーまで届きません。なぜならARP要求はルーターを超えることができないからです。
        <br>ルータにたどり着くとルーターがパケットのIP部分を取り出して適切な次のネットワークに送り出すのを繰り返して最終的にはDNSサーバーに届きます。
        <br>このように名前解決の要求は回り回ってDNSAサーバーに届きます

      </div>
    </div>
    <div class="sectionWrapper">
      <h2>UDPとTCP</h2>
      TCPとIPで通信する場合のアプリケーション層の通信方法はUDPとTCPの2つがあります
      <div class="itemWrapper">
        <h3>UDPでのデータ通信</h3>
        UDPはステートレスプロトコルと呼ばれる、状態を持たないプロトコルです。
        <br>UDPの構造は単純で送信元ポート番号と宛先ポート番号、データ長とチェックサム以外のものが無いです。
        <br>パケットはデータ長が正しいか、チェックサムによりデータが壊れていないかの2つしかチェックされません。
        <br>UDPは高速通信に特化しており、相手がデータを受け取ったかどうかの確認など正しい通信を保証するものではありません

      </div>
      <div class="itemWrapper">
        <h3>TCPでの通信</h3>
        TCPはUDPとはちがいセキュアな通信をするときに使われます。例えばデータベースにデータを格納するときなど、相手がデータをうけとったかどうかの確認をします。
      </div>
      <div class="itemWrapper">
        <h3>3ウェイハンドシェイク</h3>
        TCPでは通信するもの同士の間にコネクションを確立します。
        <br>その方法が3ウェイハンドシェイクです
        <ul>
          <li>SYN:接続開始要求</li>
          <li>ACK:要求受け入れ</li>
          <li>URG:緊急データが入っていることを示す</li>
          <li>PSH:即時送信データが有ることを示す</li>
          <li>RST:エラーで通信をリセットしたことを示す</li>
          <li>FIN:通信終了要求</li>

        </ul>
        <div class="box">
          <h4>相手からの通信を受け入れない設定</h4>
          ファイアウォール載せて血で自分から通信を始めるのは良いけれど、相手から自分側に接続してくるのは拒否したいと言うときにする構成があります。
          <br>それはTCPの3ウェイハンドシェイクのSYNがついたパケットを通さないという設定です
          。
        </div>

      </div>
      <div class="itemWrapper">
        <h3>順序を治すためのシーケンス番号</h3>
        TCP通信で肝となるのがACKなんです。以外だなぁ
        <br>パケットにはシーケンス番号がついていて、ACKを返すときには次にほしいシーケンス番号を応答番号として返します。
        <br>もし順序が間違っていたら、再送してほしいシーケンス番号を返して再送してもらいます。
        <br>つまり、送信側はACKと応答番号を確認して正しい通信を判断できるのです。
        <br>データの再送はTCPが自動的に行うのでそれより上のHTTPが判断する必要はアリません。
      </div>
    </div>
    <div class="sectionWrapper">
      <h2>まとめ　</h2>
      今回の章でまとめたのは次の2つです
      <ol>
        <li>TCP/IPにおいてパケットが送信される仕組み</li>
        アプリケーション層、トランスポート層、インターネット層、インターフェース層の4つの層が、それぞれ届いたパケットにヘッダをつけて下の層へとデータを受け渡します。
        <br>Ethernetの場合は最終的にMACアドレスを宛先としてデータを送信します。
        <br>MACアドレスはARPでIPアドレスに変換されます
        <br>ARPの到達範囲はルーターまでで、ルータがIPアドレスから判断して、次のネットワークに送り出します。
        <li>UDPとTCPの違い</li>
        トランスポート層にはUDPとTCPがあり、前者は高速に通信することを、後者は確実に通信するための仕組みです
        <br>TCPでの通信は3ウェイハンドシェイクから蛇島リ、TCPで送受信するデータにはシーケンス番号がつけられて、次にほしいシーケンス番号を応答番号として返します。
        <br>
      </ol>
    </div>
  </div>
</body>
</html>
